{{!--
Docs Right Sidebar Component
"On This Page" navigation for documentation pages
Auto-generates links based on h2 and h3 headings with IDs
--}}

<aside
    class="docs-right-sidebar hidden xl:block fixed top-16 right-0 w-[220px] h-[calc(100vh-4rem)] border-l border-border bg-background overflow-y-auto">
    <div class="p-4">
        <h4 class="text-sm font-semibold text-foreground mb-3">On This Page</h4>
        <nav class="docs-toc space-y-1" id="docs-toc-nav">
            <!-- Links will be auto-generated by JavaScript -->
        </nav>
    </div>
</aside>

<script>
    // Auto-generate table of contents from page headings
    document.addEventListener('DOMContentLoaded', function () {
        const tocNav = document.getElementById('docs-toc-nav');
        if (!tocNav) return;

        // Find all h2 and h3 with IDs, and example-block sections
        const headings = document.querySelectorAll('main h2[id], main h3[id], main .example-block[id]');

        headings.forEach(heading => {
            const link = document.createElement('a');
            link.href = '#' + heading.id;

            // Get title text
            let title = '';
            if (heading.classList.contains('example-block')) {
                const h3 = heading.querySelector('h3');
                title = h3 ? h3.textContent : heading.id;
            } else {
                title = heading.textContent;
            }

            link.textContent = title;
            link.className = 'toc-link block text-sm text-muted-foreground hover:text-foreground transition-colors py-1 pl-2 border-l-2 border-transparent hover:border-primary/50';

            // Indent h3 and example-blocks
            if (heading.tagName === 'H3' || heading.classList.contains('example-block')) {
                link.classList.add('pl-4', 'text-xs');
            }

            // Smooth scroll to target on click
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = document.getElementById(heading.id);
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    // Update URL hash without scrolling again
                    history.pushState(null, '', '#' + heading.id);
                }
            });

            tocNav.appendChild(link);
        });

        // Highlight active section on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    document.querySelectorAll('.toc-link').forEach(link => {
                        link.classList.remove('text-foreground', 'border-primary');
                        if (link.getAttribute('href') === '#' + id) {
                            link.classList.add('text-foreground', 'border-primary');
                        }
                    });
                }
            });
        }, { rootMargin: '-20% 0px -80% 0px' });

        headings.forEach(heading => observer.observe(heading));
    });
</script>